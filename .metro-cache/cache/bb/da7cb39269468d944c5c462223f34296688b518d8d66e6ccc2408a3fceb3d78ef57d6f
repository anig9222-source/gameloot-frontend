{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":69,"index":159}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":160},"end":{"line":3,"column":26,"index":186}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/contexts/AuthContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"AuthProvider\", {\n    enumerable: true,\n    get: function () {\n      return AuthProvider;\n    }\n  });\n  Object.defineProperty(exports, \"useAuth\", {\n    enumerable: true,\n    get: function () {\n      return useAuth;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _axios = require(_dependencyMap[2], \"axios\");\n  var axios = _interopDefault(_axios);\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  const AuthProvider = ({\n    children\n  }) => {\n    const [user, setUser] = (0, _react.useState)(null);\n    const [token, setToken] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    (0, _react.useEffect)(() => {\n      loadStoredAuth();\n    }, []);\n    const loadStoredAuth = async () => {\n      try {\n        const storedToken = await AsyncStorage.default.getItem('token');\n        const storedUser = await AsyncStorage.default.getItem('user');\n        if (storedToken && storedUser) {\n          setToken(storedToken);\n          setUser(JSON.parse(storedUser));\n        }\n      } catch (error) {\n        console.error('Error loading auth:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    const login = async (email, password) => {\n      console.log('[AUTH] Login attempt for:', email);\n      const API_URL = process.env.EXPO_PUBLIC_BACKEND_URL;\n      try {\n        const response = await axios.default.post(`${API_URL}/api/auth/login`, {\n          email,\n          password\n        });\n        const {\n          access_token,\n          user: userData\n        } = response.data;\n        console.log('[AUTH] Login successful, got token');\n\n        // Persist to AsyncStorage FIRST (wait for it)\n        await AsyncStorage.default.setItem('token', access_token);\n        await AsyncStorage.default.setItem('user', JSON.stringify(userData));\n        console.log('[AUTH] Token saved to AsyncStorage');\n\n        // Then update state\n        setToken(access_token);\n        setUser(userData);\n        console.log('[AUTH] State updated - user logged in');\n      } catch (error) {\n        console.error('[AUTH] Login error:', error);\n        throw error;\n      }\n    };\n    const register = async (email, password, referralCode) => {\n      const API_URL = process.env.EXPO_PUBLIC_BACKEND_URL;\n      const response = await axios.default.post(`${API_URL}/api/auth/register`, {\n        email,\n        password,\n        referred_by: referralCode || null\n      });\n      const {\n        access_token,\n        user: userData\n      } = response.data;\n\n      // Update state FIRST (synchronous)\n      setToken(access_token);\n      setUser(userData);\n\n      // Then persist to AsyncStorage (fire and forget)\n      AsyncStorage.default.setItem('token', access_token);\n      AsyncStorage.default.setItem('user', JSON.stringify(userData));\n    };\n    const logout = async () => {\n      console.log('[AUTH] Logout initiated');\n      try {\n        // Clear AsyncStorage FIRST (wait for it)\n        await AsyncStorage.default.removeItem('token');\n        await AsyncStorage.default.removeItem('user');\n        console.log('[AUTH] AsyncStorage cleared');\n\n        // Then update state\n        setToken(null);\n        setUser(null);\n        console.log('[AUTH] State cleared - token and user set to null');\n      } catch (error) {\n        console.error('[AUTH] Error during logout:', error);\n        // Still clear state even if storage fails\n        setToken(null);\n        setUser(null);\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        user,\n        token,\n        loading,\n        login,\n        register,\n        logout,\n        isAuthenticated: !!token\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 5\n    }, this);\n  };\n  const useAuth = () => {\n    const context = (0, _react.useContext)(AuthContext);\n    if (context === undefined) {\n      throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n  };\n});","lineCount":146,"map":[[13,2,22,0,"Object"],[13,8,22,0],[13,9,22,0,"defineProperty"],[13,23,22,0],[13,24,22,0,"exports"],[13,31,22,0],[14,4,22,0,"enumerable"],[14,14,22,0],[15,4,22,0,"get"],[15,7,22,0],[15,18,22,0,"get"],[15,19,22,0],[16,6,22,0],[16,13,22,0,"AuthProvider"],[16,25,22,0],[17,4,22,0],[18,2,22,0],[19,2,132,0,"Object"],[19,8,132,0],[19,9,132,0,"defineProperty"],[19,23,132,0],[19,24,132,0,"exports"],[19,31,132,0],[20,4,132,0,"enumerable"],[20,14,132,0],[21,4,132,0,"get"],[21,7,132,0],[21,18,132,0,"get"],[21,19,132,0],[22,6,132,0],[22,13,132,0,"useAuth"],[22,20,132,0],[23,4,132,0],[24,2,132,0],[25,2,1,0],[25,6,1,0,"_react"],[25,12,1,0],[25,15,1,0,"require"],[25,22,1,0],[25,23,1,0,"_dependencyMap"],[25,37,1,0],[26,2,2,0],[26,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[26,42,2,0],[26,45,2,0,"require"],[26,52,2,0],[26,53,2,0,"_dependencyMap"],[26,67,2,0],[27,2,2,0],[27,6,2,0,"AsyncStorage"],[27,18,2,0],[27,21,2,0,"_interopDefault"],[27,36,2,0],[27,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[27,73,2,0],[28,2,3,0],[28,6,3,0,"_axios"],[28,12,3,0],[28,15,3,0,"require"],[28,22,3,0],[28,23,3,0,"_dependencyMap"],[28,37,3,0],[29,2,3,0],[29,6,3,0,"axios"],[29,11,3,0],[29,14,3,0,"_interopDefault"],[29,29,3,0],[29,30,3,0,"_axios"],[29,36,3,0],[30,2,3,26],[30,6,3,26,"_reactJsxDevRuntime"],[30,25,3,26],[30,28,3,26,"require"],[30,35,3,26],[30,36,3,26,"_dependencyMap"],[30,50,3,26],[31,2,20,0],[31,8,20,6,"AuthContext"],[31,19,20,17],[31,35,20,20],[31,39,20,20,"createContext"],[31,45,20,33],[31,46,20,33,"createContext"],[31,59,20,33],[31,61,20,63,"undefined"],[31,70,20,72],[31,71,20,73],[32,2,22,7],[32,8,22,13,"AuthProvider"],[32,20,22,25],[32,23,22,28,"AuthProvider"],[32,24,22,29],[33,4,22,31,"children"],[34,2,22,65],[34,3,22,66],[34,8,22,71],[35,4,23,2],[35,10,23,8],[35,11,23,9,"user"],[35,15,23,13],[35,17,23,15,"setUser"],[35,24,23,22],[35,25,23,23],[35,28,23,26],[35,32,23,26,"useState"],[35,38,23,34],[35,39,23,34,"useState"],[35,47,23,34],[35,49,23,48],[35,53,23,52],[35,54,23,53],[36,4,24,2],[36,10,24,8],[36,11,24,9,"token"],[36,16,24,14],[36,18,24,16,"setToken"],[36,26,24,24],[36,27,24,25],[36,30,24,28],[36,34,24,28,"useState"],[36,40,24,36],[36,41,24,36,"useState"],[36,49,24,36],[36,51,24,52],[36,55,24,56],[36,56,24,57],[37,4,25,2],[37,10,25,8],[37,11,25,9,"loading"],[37,18,25,16],[37,20,25,18,"setLoading"],[37,30,25,28],[37,31,25,29],[37,34,25,32],[37,38,25,32,"useState"],[37,44,25,40],[37,45,25,40,"useState"],[37,53,25,40],[37,55,25,41],[37,59,25,45],[37,60,25,46],[38,4,27,2],[38,8,27,2,"useEffect"],[38,14,27,11],[38,15,27,11,"useEffect"],[38,24,27,11],[38,26,27,12],[38,32,27,18],[39,6,28,4,"loadStoredAuth"],[39,20,28,18],[39,21,28,19],[39,22,28,20],[40,4,29,2],[40,5,29,3],[40,7,29,5],[40,9,29,7],[40,10,29,8],[41,4,31,2],[41,10,31,8,"loadStoredAuth"],[41,24,31,22],[41,27,31,25],[41,33,31,25,"loadStoredAuth"],[41,34,31,25],[41,39,31,37],[42,6,32,4],[42,10,32,8],[43,8,33,6],[43,14,33,12,"storedToken"],[43,25,33,23],[43,28,33,26],[43,34,33,32,"AsyncStorage"],[43,46,33,44],[43,47,33,44,"default"],[43,54,33,44],[43,55,33,45,"getItem"],[43,62,33,52],[43,63,33,53],[43,70,33,60],[43,71,33,61],[44,8,34,6],[44,14,34,12,"storedUser"],[44,24,34,22],[44,27,34,25],[44,33,34,31,"AsyncStorage"],[44,45,34,43],[44,46,34,43,"default"],[44,53,34,43],[44,54,34,44,"getItem"],[44,61,34,51],[44,62,34,52],[44,68,34,58],[44,69,34,59],[45,8,36,6],[45,12,36,10,"storedToken"],[45,23,36,21],[45,27,36,25,"storedUser"],[45,37,36,35],[45,39,36,37],[46,10,37,8,"setToken"],[46,18,37,16],[46,19,37,17,"storedToken"],[46,30,37,28],[46,31,37,29],[47,10,38,8,"setUser"],[47,17,38,15],[47,18,38,16,"JSON"],[47,22,38,20],[47,23,38,21,"parse"],[47,28,38,26],[47,29,38,27,"storedUser"],[47,39,38,37],[47,40,38,38],[47,41,38,39],[48,8,39,6],[49,6,40,4],[49,7,40,5],[49,8,40,6],[49,15,40,13,"error"],[49,20,40,18],[49,22,40,20],[50,8,41,6,"console"],[50,15,41,13],[50,16,41,14,"error"],[50,21,41,19],[50,22,41,20],[50,43,41,41],[50,45,41,43,"error"],[50,50,41,48],[50,51,41,49],[51,6,42,4],[51,7,42,5],[51,16,42,14],[52,8,43,6,"setLoading"],[52,18,43,16],[52,19,43,17],[52,24,43,22],[52,25,43,23],[53,6,44,4],[54,4,45,2],[54,5,45,3],[55,4,47,2],[55,10,47,8,"login"],[55,15,47,13],[55,18,47,16],[55,24,47,16,"login"],[55,25,47,23,"email"],[55,30,47,36],[55,32,47,38,"password"],[55,40,47,54],[55,45,47,59],[56,6,48,4,"console"],[56,13,48,11],[56,14,48,12,"log"],[56,17,48,15],[56,18,48,16],[56,45,48,43],[56,47,48,45,"email"],[56,52,48,50],[56,53,48,51],[57,6,49,4],[57,12,49,10,"API_URL"],[57,19,49,17],[57,22,49,20,"process"],[57,29,49,27],[57,30,49,28,"env"],[57,33,49,31],[57,34,49,32,"EXPO_PUBLIC_BACKEND_URL"],[57,57,49,55],[58,6,51,4],[58,10,51,8],[59,8,52,6],[59,14,52,12,"response"],[59,22,52,20],[59,25,52,23],[59,31,52,29,"axios"],[59,36,52,34],[59,37,52,34,"default"],[59,44,52,34],[59,45,52,35,"post"],[59,49,52,39],[59,50,52,40],[59,53,52,43,"API_URL"],[59,60,52,50],[59,77,52,67],[59,79,52,69],[60,10,53,8,"email"],[60,15,53,13],[61,10,54,8,"password"],[62,8,55,6],[62,9,55,7],[62,10,55,8],[63,8,57,6],[63,14,57,12],[64,10,57,14,"access_token"],[64,22,57,26],[65,10,57,28,"user"],[65,14,57,32],[65,16,57,34,"userData"],[66,8,57,43],[66,9,57,44],[66,12,57,47,"response"],[66,20,57,55],[66,21,57,56,"data"],[66,25,57,60],[67,8,58,6,"console"],[67,15,58,13],[67,16,58,14,"log"],[67,19,58,17],[67,20,58,18],[67,56,58,54],[67,57,58,55],[69,8,60,6],[70,8,61,6],[70,14,61,12,"AsyncStorage"],[70,26,61,24],[70,27,61,24,"default"],[70,34,61,24],[70,35,61,25,"setItem"],[70,42,61,32],[70,43,61,33],[70,50,61,40],[70,52,61,42,"access_token"],[70,64,61,54],[70,65,61,55],[71,8,62,6],[71,14,62,12,"AsyncStorage"],[71,26,62,24],[71,27,62,24,"default"],[71,34,62,24],[71,35,62,25,"setItem"],[71,42,62,32],[71,43,62,33],[71,49,62,39],[71,51,62,41,"JSON"],[71,55,62,45],[71,56,62,46,"stringify"],[71,65,62,55],[71,66,62,56,"userData"],[71,74,62,64],[71,75,62,65],[71,76,62,66],[72,8,63,6,"console"],[72,15,63,13],[72,16,63,14,"log"],[72,19,63,17],[72,20,63,18],[72,56,63,54],[72,57,63,55],[74,8,65,6],[75,8,66,6,"setToken"],[75,16,66,14],[75,17,66,15,"access_token"],[75,29,66,27],[75,30,66,28],[76,8,67,6,"setUser"],[76,15,67,13],[76,16,67,14,"userData"],[76,24,67,22],[76,25,67,23],[77,8,68,6,"console"],[77,15,68,13],[77,16,68,14,"log"],[77,19,68,17],[77,20,68,18],[77,59,68,57],[77,60,68,58],[78,6,69,4],[78,7,69,5],[78,8,69,6],[78,15,69,13,"error"],[78,20,69,18],[78,22,69,20],[79,8,70,6,"console"],[79,15,70,13],[79,16,70,14,"error"],[79,21,70,19],[79,22,70,20],[79,43,70,41],[79,45,70,43,"error"],[79,50,70,48],[79,51,70,49],[80,8,71,6],[80,14,71,12,"error"],[80,19,71,17],[81,6,72,4],[82,4,73,2],[82,5,73,3],[83,4,75,2],[83,10,75,8,"register"],[83,18,75,16],[83,21,75,19],[83,27,75,19,"register"],[83,28,75,26,"email"],[83,33,75,39],[83,35,75,41,"password"],[83,43,75,57],[83,45,75,59,"referralCode"],[83,57,75,80],[83,62,75,85],[84,6,76,4],[84,12,76,10,"API_URL"],[84,19,76,17],[84,22,76,20,"process"],[84,29,76,27],[84,30,76,28,"env"],[84,33,76,31],[84,34,76,32,"EXPO_PUBLIC_BACKEND_URL"],[84,57,76,55],[85,6,77,4],[85,12,77,10,"response"],[85,20,77,18],[85,23,77,21],[85,29,77,27,"axios"],[85,34,77,32],[85,35,77,32,"default"],[85,42,77,32],[85,43,77,33,"post"],[85,47,77,37],[85,48,77,38],[85,51,77,41,"API_URL"],[85,58,77,48],[85,78,77,68],[85,80,77,70],[86,8,78,6,"email"],[86,13,78,11],[87,8,79,6,"password"],[87,16,79,14],[88,8,80,6,"referred_by"],[88,19,80,17],[88,21,80,19,"referralCode"],[88,33,80,31],[88,37,80,35],[89,6,81,4],[89,7,81,5],[89,8,81,6],[90,6,83,4],[90,12,83,10],[91,8,83,12,"access_token"],[91,20,83,24],[92,8,83,26,"user"],[92,12,83,30],[92,14,83,32,"userData"],[93,6,83,41],[93,7,83,42],[93,10,83,45,"response"],[93,18,83,53],[93,19,83,54,"data"],[93,23,83,58],[95,6,85,4],[96,6,86,4,"setToken"],[96,14,86,12],[96,15,86,13,"access_token"],[96,27,86,25],[96,28,86,26],[97,6,87,4,"setUser"],[97,13,87,11],[97,14,87,12,"userData"],[97,22,87,20],[97,23,87,21],[99,6,89,4],[100,6,90,4,"AsyncStorage"],[100,18,90,16],[100,19,90,16,"default"],[100,26,90,16],[100,27,90,17,"setItem"],[100,34,90,24],[100,35,90,25],[100,42,90,32],[100,44,90,34,"access_token"],[100,56,90,46],[100,57,90,47],[101,6,91,4,"AsyncStorage"],[101,18,91,16],[101,19,91,16,"default"],[101,26,91,16],[101,27,91,17,"setItem"],[101,34,91,24],[101,35,91,25],[101,41,91,31],[101,43,91,33,"JSON"],[101,47,91,37],[101,48,91,38,"stringify"],[101,57,91,47],[101,58,91,48,"userData"],[101,66,91,56],[101,67,91,57],[101,68,91,58],[102,4,92,2],[102,5,92,3],[103,4,94,2],[103,10,94,8,"logout"],[103,16,94,14],[103,19,94,17],[103,25,94,17,"logout"],[103,26,94,17],[103,31,94,29],[104,6,95,4,"console"],[104,13,95,11],[104,14,95,12,"log"],[104,17,95,15],[104,18,95,16],[104,43,95,41],[104,44,95,42],[105,6,97,4],[105,10,97,8],[106,8,98,6],[107,8,99,6],[107,14,99,12,"AsyncStorage"],[107,26,99,24],[107,27,99,24,"default"],[107,34,99,24],[107,35,99,25,"removeItem"],[107,45,99,35],[107,46,99,36],[107,53,99,43],[107,54,99,44],[108,8,100,6],[108,14,100,12,"AsyncStorage"],[108,26,100,24],[108,27,100,24,"default"],[108,34,100,24],[108,35,100,25,"removeItem"],[108,45,100,35],[108,46,100,36],[108,52,100,42],[108,53,100,43],[109,8,101,6,"console"],[109,15,101,13],[109,16,101,14,"log"],[109,19,101,17],[109,20,101,18],[109,49,101,47],[109,50,101,48],[111,8,103,6],[112,8,104,6,"setToken"],[112,16,104,14],[112,17,104,15],[112,21,104,19],[112,22,104,20],[113,8,105,6,"setUser"],[113,15,105,13],[113,16,105,14],[113,20,105,18],[113,21,105,19],[114,8,106,6,"console"],[114,15,106,13],[114,16,106,14,"log"],[114,19,106,17],[114,20,106,18],[114,71,106,69],[114,72,106,70],[115,6,107,4],[115,7,107,5],[115,8,107,6],[115,15,107,13,"error"],[115,20,107,18],[115,22,107,20],[116,8,108,6,"console"],[116,15,108,13],[116,16,108,14,"error"],[116,21,108,19],[116,22,108,20],[116,51,108,49],[116,53,108,51,"error"],[116,58,108,56],[116,59,108,57],[117,8,109,6],[118,8,110,6,"setToken"],[118,16,110,14],[118,17,110,15],[118,21,110,19],[118,22,110,20],[119,8,111,6,"setUser"],[119,15,111,13],[119,16,111,14],[119,20,111,18],[119,21,111,19],[120,6,112,4],[121,4,113,2],[121,5,113,3],[122,4,115,2],[122,24,116,4],[122,28,116,4,"_reactJsxDevRuntime"],[122,47,116,4],[122,48,116,4,"jsxDEV"],[122,54,116,4],[122,56,116,5,"AuthContext"],[122,67,116,16],[122,68,116,17,"Provider"],[122,76,116,25],[123,6,117,6,"value"],[123,11,117,11],[123,13,117,13],[124,8,118,8,"user"],[124,12,118,12],[125,8,119,8,"token"],[125,13,119,13],[126,8,120,8,"loading"],[126,15,120,15],[127,8,121,8,"login"],[127,13,121,13],[128,8,122,8,"register"],[128,16,122,16],[129,8,123,8,"logout"],[129,14,123,14],[130,8,124,8,"isAuthenticated"],[130,23,124,23],[130,25,124,25],[130,26,124,26],[130,27,124,27,"token"],[131,6,125,6],[131,7,125,8],[132,6,125,8,"children"],[132,14,125,8],[132,16,127,7,"children"],[133,4,127,15],[134,6,127,15,"fileName"],[134,14,127,15],[134,16,127,15,"_jsxFileName"],[134,28,127,15],[135,6,127,15,"lineNumber"],[135,16,127,15],[136,6,127,15,"columnNumber"],[136,18,127,15],[137,4,127,15],[137,11,128,26],[137,12,128,27],[138,2,130,0],[138,3,130,1],[139,2,132,7],[139,8,132,13,"useAuth"],[139,15,132,20],[139,18,132,23,"useAuth"],[139,19,132,23],[139,24,132,29],[140,4,133,2],[140,10,133,8,"context"],[140,17,133,15],[140,20,133,18],[140,24,133,18,"useContext"],[140,30,133,28],[140,31,133,28,"useContext"],[140,41,133,28],[140,43,133,29,"AuthContext"],[140,54,133,40],[140,55,133,41],[141,4,134,2],[141,8,134,6,"context"],[141,15,134,13],[141,20,134,18,"undefined"],[141,29,134,27],[141,31,134,29],[142,6,135,4],[142,12,135,10],[142,16,135,14,"Error"],[142,21,135,19],[142,22,135,20],[142,67,135,65],[142,68,135,66],[143,4,136,2],[144,4,137,2],[144,11,137,9,"context"],[144,18,137,16],[145,2,138,0],[145,3,138,1],[146,0,138,2],[146,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","loadStoredAuth","login","register","logout","useAuth"],"mappings":"AAA;4BCqB;YCK;GDE;yBEE;GFc;gBGE;GH0B;mBIE;GJiB;iBKE;GLmB;CDiB;uBOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}